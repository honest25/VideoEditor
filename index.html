<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CineStudio Ultra Mobile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --gold: #fbbf24; --pro-black: #020202; }
        body { background: var(--pro-black); color: #fff; font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; touch-action: none; }
        
        /* Mobile Viewport Architecture */
        .app-container { display: flex; flex-direction: column; height: 100vh; }
        
        /* Canvas Engine */
        .preview-pane { flex: 1; position: relative; display: flex; align-items: center; justify-content: center; background: #000; }
        canvas { max-width: 90%; height: auto; aspect-ratio: 9/16; background: #111; box-shadow: 0 0 40px rgba(251, 191, 36, 0.1); }
        
        /* Mobile Pro Timeline */
        .timeline-area { height: 220px; background: #0a0a0a; border-top: 1px solid #222; overflow-x: auto; position: relative; white-space: nowrap; }
        .track { height: 40px; margin: 8px 0; background: rgba(255,255,255,0.02); position: relative; min-width: 3000px; }
        .clip { position: absolute; height: 32px; border-radius: 4px; border: 1px solid rgba(255,255,255,0.2); font-size: 10px; padding: 4px; }
        .v-clip { background: linear-gradient(90deg, #1e40af, #3b82f6); }
        .a-clip { background: linear-gradient(90deg, #047857, #10b981); }
        .playhead { position: absolute; left: 0; top: 0; bottom: 0; width: 2px; background: #ff0000; z-index: 50; box-shadow: 0 0 10px red; }

        /* Control Dock */
        .dock { height: 70px; background: #000; border-top: 1px solid #222; display: flex; justify-content: space-around; align-items: center; }
        .btn-icon { display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #777; transition: 0.2s; }
        .btn-icon:active { color: var(--gold); transform: scale(0.9); }
    </style>
</head>
<body>

<div class="app-container">
    <header class="h-14 border-b border-zinc-800 flex items-center justify-between px-4">
        <div class="flex items-center gap-2">
            <span class="text-amber-500 font-black italic">ULTRA</span>
            <input type="text" id="project-title" value="CINE_PRO_001" class="bg-transparent text-xs font-bold outline-none border-b border-zinc-800 focus:border-amber-500 w-32">
        </div>
        <button onclick="startExport()" class="bg-amber-500 text-black px-4 py-1 rounded-full text-[10px] font-black uppercase">Render</button>
    </header>

    <section class="preview-pane">
        <canvas id="studio-canvas"></canvas>
        <div class="absolute bottom-4 flex gap-8">
            <button onclick="togglePlay()" class="w-12 h-12 bg-white/10 backdrop-blur rounded-full flex items-center justify-center"><i class="fa-solid fa-play" id="play-icon"></i></button>
        </div>
    </section>

    <section class="timeline-area" id="timeline">
        <div class="playhead" id="playhead"></div>
        <div class="track" id="v-track"></div>
        <div class="track" id="a-track"></div>
        <div class="px-4 py-2 flex items-center gap-4 bg-zinc-900/50">
            <span class="text-[9px] uppercase font-bold text-zinc-500">Speed Ramp</span>
            <input type="range" id="speed-ramp" min="0.5" max="2.5" step="0.1" value="1" class="w-full accent-amber-500">
        </div>
    </section>

    <nav class="dock">
        <label class="btn-icon">
            <i class="fa-solid fa-file-import text-lg"></i>
            <span>Import</span>
            <input type="file" id="media-in" hidden multiple accept="video/*,audio/*,image/*">
        </label>
        <div class="btn-icon" onclick="applyEffect('grain')">
            <i class="fa-solid fa-film text-lg"></i>
            <span>Film Grain</span>
        </div>
        <div class="btn-icon" onclick="trimClip()">
            <i class="fa-solid fa-scissors text-lg"></i>
            <span>Trim At Playhead</span>
        </div>
        <div class="btn-icon" onclick="setRatio(9/16)">
            <i class="fa-solid fa-mobile-screen text-lg"></i>
            <span>9:16 Lock</span>
        </div>
    </nav>
</div>

<script>
    const canvas = document.getElementById('studio-canvas');
    const ctx = canvas.getContext('2d');
    let video = null, audio = null, isPlaying = false, hasGrain = false;

    canvas.width = 1080; canvas.height = 1920;

    // --- Media Engine ---
    document.getElementById('media-in').onchange = (e) => {
        const file = e.target.files[0];
        const url = URL.createObjectURL(file);
        const type = file.type.split('/')[0];

        if(type === 'video') {
            video = document.createElement('video');
            video.src = url; video.loop = true; video.muted = true;
            addClip(file.name, 'v-clip', 'v-track');
        } else if(type === 'audio') {
            audio = new Audio(url);
            addClip(file.name, 'a-clip', 'a-track');
        }
    };

    function addClip(name, cls, track) {
        const clip = document.createElement('div');
        clip.className = `clip ${cls}`;
        clip.style.width = "200px"; clip.style.left = "50px";
        clip.innerText = name.substring(0,10);
        document.getElementById(track).appendChild(clip);
    }

    // --- Professional FX & Ramping ---
    function applyEffect(type) {
        if(type === 'grain') hasGrain = !hasGrain;
    }

    document.getElementById('speed-ramp').oninput = (e) => {
        if(video) video.playbackRate = e.target.value;
        if(audio) audio.playbackRate = e.target.value;
    };

    // --- Render Engine ---
    function draw() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        if(video) {
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Motion Blur Simulation (Alpha ghosting)
            if(video.playbackRate > 1.5) {
                ctx.globalAlpha = 0.3;
                ctx.drawImage(video, -10, 0, canvas.width, canvas.height);
                ctx.globalAlpha = 1.0;
            }

            // Film Grain Overlay
            if(hasGrain) {
                for (let i = 0; i < 5000; i++) {
                    ctx.fillStyle = `rgba(255,255,255,${Math.random() * 0.05})`;
                    ctx.fillRect(Math.random()*canvas.width, Math.random()*canvas.height, 2, 2);
                }
            }
            
            // Sync Playhead
            const pos = (video.currentTime / video.duration) * 1000;
            document.getElementById('playhead').style.left = pos + 'px';
        }
        requestAnimationFrame(draw);
    }

    function togglePlay() {
        isPlaying = !isPlaying;
        if(isPlaying) { video?.play(); audio?.play(); } 
        else { video?.pause(); audio?.pause(); }
        document.getElementById('play-icon').className = isPlaying ? "fa-solid fa-pause" : "fa-solid fa-play";
    }

    async function startExport() {
        const stream = canvas.captureStream(60);
        const rec = new MediaRecorder(stream, { mimeType: 'video/webm', bitsPerSecond: 10000000 });
        let chunks = [];
        rec.ondataavailable = e => chunks.push(e.data);
        rec.onstop = () => {
            const b = new Blob(chunks, {type:'video/webm'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'Master_Export.webm'; a.click();
        };
        rec.start();
        alert("RENDERING PRO EXPORT: 10 Seconds starting now.");
        setTimeout(() => rec.stop(), 10000);
    }

    draw();
</script>
</body>
</html>
