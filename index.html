<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineStudio | Project Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --accent: #fbbf24; --bg: #050505; --panel: #111; }
        body { background: var(--bg); color: #eee; font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; margin: 0; }
        .studio-root { display: grid; grid-template-columns: 320px 1fr 320px; grid-template-rows: 60px 1fr 280px; height: 100vh; }
        .preview-box { background: radial-gradient(circle, #1a1a1a 0%, #000 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; border: 1px solid #222; }
        canvas { background: #000; box-shadow: 0 0 100px rgba(0,0,0,0.8); }
        .timeline-box { grid-column: 1 / span 3; background: #0a0a0a; border-top: 2px solid #222; overflow-x: auto; position: relative; }
        .track { height: 50px; border-bottom: 1px solid #1a1a1a; position: relative; min-width: 5000px; display: flex; align-items: center; }
        .clip-item { height: 35px; border-radius: 4px; position: absolute; cursor: pointer; display: flex; align-items: center; padding: 0 10px; font-size: 10px; font-weight: bold; }
        .v-clip { background: linear-gradient(90deg, #1e40af, #3b82f6); border: 1px solid #60a5fa; }
        .i-clip { background: linear-gradient(90deg, #6b21a8, #a855f7); border: 1px solid #c084fc; }
        .playhead { width: 2px; height: 100%; background: #ff0000; position: absolute; left: 0; z-index: 100; pointer-events: none; }
    </style>
</head>
<body>

<div class="studio-root">
    <header class="col-span-3 border-b border-zinc-800 flex items-center justify-between px-6 bg-black">
        <div class="flex items-center gap-4">
            <i class="fa-solid fa-clapperboard text-amber-500 text-xl"></i>
            <input type="text" id="project-name" value="Untitled_Hollywood_Project" class="bg-transparent border-none text-sm font-bold focus:ring-0 w-64 text-zinc-300">
        </div>
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-2">
                <span class="text-[10px] text-zinc-500 uppercase font-black">Aspect:</span>
                <select id="ratio-select" onchange="setRatio(this.value)" class="bg-zinc-900 text-xs border border-zinc-700 px-2 py-1 rounded">
                    <option value="16/9">16:9 Cinema</option>
                    <option value="9/16">9:16 Vertical</option>
                    <option value="1/1">1:1 Square</option>
                </select>
            </div>
            <button onclick="startExport()" class="bg-amber-500 text-black px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-tighter hover:bg-white transition-all">Render Master</button>
        </div>
    </header>

    <aside class="p-4 border-r border-zinc-800 space-y-6 overflow-y-auto">
        <div>
            <span class="text-[10px] font-black text-zinc-500 uppercase">Unified Media Pool</span>
            <label class="block mt-2 bg-zinc-800 hover:bg-zinc-700 p-3 rounded text-center text-[10px] cursor-pointer font-bold border-2 border-dashed border-zinc-700">
                <i class="fa-solid fa-plus block mb-1 text-lg"></i> ADD VIDEO/IMAGE
                <input type="file" id="media-loader" hidden multiple accept="video/*,image/*">
            </label>
        </div>
        <div id="media-list" class="space-y-2"></div>
    </aside>

    <main class="preview-box">
        <canvas id="main-canvas"></canvas>
        <div class="absolute bottom-4 flex gap-6 bg-black/80 px-8 py-3 rounded-full border border-white/10 backdrop-blur-md">
            <button onclick="togglePlay()"><i class="fa-solid fa-play text-amber-500 text-xl" id="play-btn"></i></button>
        </div>
    </main>

    <aside class="p-4 border-l border-zinc-800 space-y-6">
        <div>
            <h3 class="text-[10px] font-black text-amber-500 uppercase mb-3">Display Mode (Canva Style)</h3>
            <select id="display-mode" class="w-full bg-zinc-900 border border-zinc-700 p-2 text-xs rounded">
                <option value="fit">Fit to Screen</option>
                <option value="fill">Fill (Crop to Frame)</option>
                <option value="stretch">Stretch (Distort)</option>
            </select>
        </div>
        <div class="p-4 bg-zinc-900 rounded-lg">
            <h3 class="text-[10px] font-black text-blue-400 uppercase mb-2">Manual Trimming</h3>
            <div class="flex flex-col gap-2">
                <button onclick="trimClip('start')" class="w-full py-2 bg-zinc-800 rounded text-[9px] uppercase hover:bg-red-900/40">Set Start</button>
                <button onclick="trimClip('end')" class="w-full py-2 bg-zinc-800 rounded text-[9px] uppercase hover:bg-red-900/40">Set End</button>
            </div>
        </div>
    </aside>

    <footer class="timeline-box" id="timeline">
        <div class="playhead" id="playhead"></div>
        <div class="track" id="vt-1"><div class="sticky left-0 bg-zinc-900 px-3 text-[9px] h-full flex items-center border-r border-zinc-700">MASTER TRACK</div></div>
        <div class="track" id="at-1"><div class="sticky left-0 bg-zinc-900 px-3 text-[9px] h-full flex items-center border-r border-zinc-700">AUDIO TRACK</div></div>
    </footer>
</div>

<script>
    const canvas = document.getElementById('main-canvas'), ctx = canvas.getContext('2d');
    let activeMedia = null, mediaType = null, isPlaying = false;

    function setRatio(rString) {
        const r = eval(rString);
        if(r > 1) { canvas.width = 1920; canvas.height = 1080; }
        else if(r < 1) { canvas.width = 1080; canvas.height = 1920; }
        else { canvas.width = 1080; canvas.height = 1080; }
        canvas.style.height = "80%"; canvas.style.aspectRatio = rString;
    }
    setRatio("16/9");

    document.getElementById('media-loader').onchange = e => {
        const file = e.target.files[0];
        const url = URL.createObjectURL(file);
        mediaType = file.type.split('/')[0];
        
        if(mediaType === 'video') {
            activeMedia = document.createElement('video');
            activeMedia.src = url; activeMedia.loop = true; activeMedia.muted = true;
            activeMedia.play();
        } else {
            activeMedia = new Image();
            activeMedia.src = url;
        }

        const div = document.createElement('div');
        div.className = `clip-item ${mediaType === 'video' ? 'v-clip' : 'i-clip'}`;
        div.style.left = "100px"; div.style.width = "300px";
        div.innerText = file.name;
        document.getElementById('vt-1').appendChild(div);
    };

    function drawMedia() {
        if (!activeMedia) return;
        const mode = document.getElementById('display-mode').value;
        const cw = canvas.width, ch = canvas.height;
        const iw = activeMedia.videoWidth || activeMedia.width;
        const ih = activeMedia.videoHeight || activeMedia.height;

        ctx.clearRect(0,0,cw,ch);
        
        if (mode === 'stretch') {
            ctx.drawImage(activeMedia, 0, 0, cw, ch);
        } else if (mode === 'fit' || mode === 'fill') {
            let scale = (mode === 'fit') ? Math.min(cw/iw, ch/ih) : Math.max(cw/iw, ch/ih);
            let nw = iw * scale, nh = ih * scale;
            let nx = (cw - nw) / 2, ny = (ch - nh) / 2;
            ctx.drawImage(activeMedia, nx, ny, nw, nh);
        }
    }

    function renderLoop() {
        if(isPlaying || mediaType === 'image') drawMedia();
        if(mediaType === 'video' && isPlaying) {
            document.getElementById('playhead').style.left = (activeMedia.currentTime / activeMedia.duration * 1000) + "px";
        }
        requestAnimationFrame(renderLoop);
    }

    function togglePlay() {
        isPlaying = !isPlaying;
        if(mediaType === 'video') isPlaying ? activeMedia.play() : activeMedia.pause();
        document.getElementById('play-btn').className = isPlaying ? "fa-solid fa-pause text-amber-500 text-xl" : "fa-solid fa-play text-amber-500 text-xl";
    }

    async function startExport() {
        const stream = canvas.captureStream(60);
        const rec = new MediaRecorder(stream, { mimeType: 'video/webm', bitsPerSecond: 8000000 });
        let chunks = [];
        rec.ondataavailable = e => chunks.push(e.data);
        rec.onstop = () => {
            const blob = new Blob(chunks, {type:'video/webm'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = document.getElementById('project-name').value + '.webm';
            a.click();
        };
        rec.start();
        alert("Recording 5 seconds of the current canvas...");
        setTimeout(() => rec.stop(), 5000);
    }

    renderLoop();
</script>
</body>
</html>
