<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CinemaStudio Pro | Hollywood Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&display=swap');
        body { font-family: 'Inter', sans-serif; background: #08080a; color: #eee; overflow: hidden; height: 100vh; }
        .cinema-font { font-family: 'Orbitron', sans-serif; }
        
        .preview-box {
            background: #000;
            box-shadow: 0 0 40px rgba(0,0,0,1), 0 0 20px rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(255,255,255,0.05);
            position: relative;
            aspect-ratio: 16/9;
        }

        .timeline-container { background: #0f0f12; border-top: 1px solid #1f1f23; }
        .track { height: 40px; background: rgba(255,255,255,0.02); margin-bottom: 4px; border-radius: 4px; position: relative; }
        .clip { position: absolute; height: 100%; border-radius: 4px; display: flex; align-items: center; padding: 0 10px; font-size: 10px; font-weight: bold; cursor: pointer; }
        .video-clip { background: linear-gradient(90deg, #1e40af, #3b82f6); border: 1px solid #60a5fa; }
        .audio-clip { background: linear-gradient(90deg, #065f46, #10b981); border: 1px solid #34d399; }

        input[type=range] { appearance: none; background: transparent; width: 100%; }
        input[type=range]::-webkit-slider-thumb { appearance: none; width: 2px; height: 200px; background: #ff0000; z-index: 50; }
        
        #loader { position: fixed; inset: 0; background: #08080a; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="loader">
        <div class="w-64 h-1 bg-zinc-800 rounded-full overflow-hidden">
            <div id="loader-bar" class="h-full bg-blue-600 w-1/3 transition-all duration-500"></div>
        </div>
        <h2 class="cinema-font text-xs mt-4 tracking-[0.5em] text-blue-500">CINEMASTUDIO PRO</h2>
        <button onclick="bootEngine()" class="mt-8 text-[10px] text-zinc-500 border border-zinc-800 px-4 py-2 rounded hover:bg-white hover:text-black transition">MANUAL START</button>
    </div>

    <div id="app" class="hidden h-screen flex flex-col">
        <nav class="h-14 px-6 flex items-center justify-between border-b border-white/5 bg-black/40 backdrop-blur-md">
            <div class="flex items-center gap-4">
                <span class="cinema-font text-blue-500 font-bold tracking-widest text-lg">CP</span>
                <div class="flex gap-4 ml-4">
                    <button onclick="document.getElementById('v-upload').click()" class="text-[10px] font-bold hover:text-blue-400">ADD VIDEO</button>
                    <button onclick="document.getElementById('a-upload').click()" class="text-[10px] font-bold hover:text-green-400">ADD MUSIC</button>
                </div>
            </div>
            <button onclick="exportHollywood()" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-1 rounded text-xs font-bold transition-all shadow-[0_0_15px_rgba(37,99,235,0.4)]">RENDER</button>
        </nav>

        <main class="flex-1 flex overflow-hidden">
            <aside class="w-16 border-r border-white/5 flex flex-col items-center py-6 gap-8 bg-black/20">
                <button onclick="setEffect('none')" title="Original" class="hover:text-blue-500"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg></button>
                <button onclick="setEffect('sepia(0.8) contrast(1.2)')" title="Vintage" class="hover:text-orange-400"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"/></svg></button>
                <button onclick="setEffect('grayscale(1)')" title="Noir" class="hover:text-zinc-400"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93s3.06-7.44 7-7.93v15.86z"/></svg></button>
            </aside>

            <section class="flex-1 flex flex-col items-center justify-center p-4 bg-[#0c0c0e]">
                <div class="preview-box w-full max-w-3xl rounded-lg overflow-hidden">
                    <canvas id="main-canvas" class="w-full h-full"></canvas>
                    <div id="fade-layer" class="absolute inset-0 bg-black pointer-events-none opacity-0 transition-opacity duration-300"></div>
                </div>
                
                <div class="mt-6 flex items-center gap-8">
                    <button onclick="jump(-5)" class="text-zinc-500 hover:text-white text-xs font-bold">REV 5s</button>
                    <button onclick="toggleMasterPlay()" class="w-14 h-14 bg-white rounded-full flex items-center justify-center text-black shadow-lg">
                        <svg id="play-icon" class="w-6 h-6 ml-1" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    </button>
                    <button onclick="jump(5)" class="text-zinc-500 hover:text-white text-xs font-bold">FWD 5s</button>
                </div>
            </section>
        </main>

        <footer class="timeline-container h-48 p-4 flex flex-col">
            <div class="flex justify-between items-center mb-2">
                <div class="flex gap-4 text-[10px] font-bold tracking-widest text-zinc-500">
                    <span id="time-now" class="text-blue-500">00:00:00</span>
                    <span id="time-total">00:00:00</span>
                </div>
                <label class="text-[10px] font-bold text-zinc-500 uppercase">Fade: <input id="fade-val" type="number" value="1" class="bg-transparent border-b border-zinc-700 w-8 text-white text-center">s</label>
            </div>

            <div class="flex-1 relative overflow-hidden bg-black/60 rounded border border-white/5">
                <input type="range" id="master-scrub" step="0.001" value="0" class="absolute inset-0 z-50 opacity-0 cursor-ew-resize">
                <div id="playhead-line" class="absolute top-0 bottom-0 w-px bg-red-600 z-40 pointer-events-none"></div>

                <div class="absolute inset-0 p-2 flex flex-col gap-2 pointer-events-none">
                    <div class="track"><div id="v-clip" class="clip video-clip hidden">VIDEO</div></div>
                    <div class="track"><div id="a-clip" class="clip audio-clip hidden">AUDIO</div></div>
                </div>
            </div>
        </footer>

        <input type="file" id="v-upload" class="hidden" accept="video/*">
        <input type="file" id="a-upload" class="hidden" accept="audio/*">
        <video id="video-engine" class="hidden" preload="auto"></video>
        <audio id="audio-engine" class="hidden" preload="auto"></audio>
    </div>

    <script>
        const studio = {
            v: document.getElementById('video-engine'),
            a: document.getElementById('audio-engine'),
            ctx: document.getElementById('main-canvas').getContext('2d'),
            canvas: document.getElementById('main-canvas'),
            fadeLayer: document.getElementById('fade-layer'),
            fx: 'none'
        };

        // BOOT SEQUENCE
        function bootEngine() {
            document.getElementById('loader').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            studio.canvas.width = 1280; // Optimized for performance
            studio.canvas.height = 720;
            renderEngine();
        }

        // Run boot when window is ready
        window.addEventListener('load', () => {
            document.getElementById('loader-bar').style.width = "100%";
            setTimeout(bootEngine, 800);
        });

        // INPUT HANDLERS
        document.getElementById('v-upload').onchange = (e) => {
            const file = e.target.files[0];
            if(!file) return;
            studio.v.src = URL.createObjectURL(file);
            studio.v.load();
            studio.v.onloadedmetadata = () => {
                document.getElementById('master-scrub').max = studio.v.duration;
                document.getElementById('v-clip').classList.remove('hidden');
                document.getElementById('v-clip').style.width = "100%";
                document.getElementById('time-total').innerText = formatTime(studio.v.duration);
            };
        };

        document.getElementById('a-upload').onchange = (e) => {
            const file = e.target.files[0];
            if(!file) return;
            studio.a.src = URL.createObjectURL(file);
            document.getElementById('a-clip').classList.remove('hidden');
            document.getElementById('a-clip').style.width = "100%";
        };

        // CORE ENGINE
        function renderEngine() {
            if (studio.v.readyState >= 2) {
                studio.ctx.filter = studio.fx;
                studio.ctx.drawImage(studio.v, 0, 0, studio.canvas.width, studio.canvas.height);
                processFades();
                if (!studio.v.paused) {
                    document.getElementById('master-scrub').value = studio.v.currentTime;
                    syncAudio();
                }
                updateUI();
            }
            requestAnimationFrame(renderEngine);
        }

        function processFades() {
            const now = studio.v.currentTime;
            const dur = studio.v.duration;
            const f = parseFloat(document.getElementById('fade-val').value) || 0;
            let opacity = 0;
            if (now < f) opacity = 1 - (now / f);
            else if (now > dur - f) opacity = (now - (dur - f)) / f;
            studio.fadeLayer.style.opacity = Math.max(0, Math.min(1, opacity));
        }

        function syncAudio() {
            if (Math.abs(studio.a.currentTime - studio.v.currentTime) > 0.15) {
                studio.a.currentTime = studio.v.currentTime;
            }
        }

        function updateUI() {
            const p = (studio.v.currentTime / studio.v.duration) * 100 || 0;
            document.getElementById('playhead-line').style.left = p + "%";
            document.getElementById('time-now').innerText = formatTime(studio.v.currentTime);
        }

        function toggleMasterPlay() {
            const icon = document.getElementById('play-icon');
            if (studio.v.paused) {
                studio.v.play();
                if(studio.a.src) studio.a.play();
                icon.innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';
            } else {
                studio.v.pause();
                studio.a.pause();
                icon.innerHTML = '<path d="M8 5v14l11-7z"/>';
            }
        }

        document.getElementById('master-scrub').oninput = (e) => {
            studio.v.currentTime = e.target.value;
            if(studio.a.src) studio.a.currentTime = e.target.value;
            updateUI();
        };

        function setEffect(eff) { studio.fx = eff; }
        function jump(amt) { studio.v.currentTime += amt; }
        function formatTime(s) {
            const m = Math.floor(s / 60);
            const sec = Math.floor(s % 60);
            return `${m.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}:00`;
        }

        function exportHollywood() {
            const stream = studio.canvas.captureStream(30);
            const recorder = new MediaRecorder(stream, { mimeType: 'video/webm;codecs=vp9' });
            const chunks = [];
            recorder.ondataavailable = e => chunks.push(e.data);
            recorder.onstop = () => {
                const a = document.createElement('a');
                a.href = URL.createObjectURL(new Blob(chunks, { type: 'video/webm' }));
                a.download = "CinemaStudio_Export.webm";
                a.click();
            };
            studio.v.currentTime = 0;
            studio.v.play();
            recorder.start();
            studio.v.onended = () => recorder.stop();
            alert("Rendering started. Keep tab open.");
        }
    </script>
</body>
</html>
